<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Driving School</title>
<style>
body{margin:0;overflow:hidden;background:#2d5016;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;color:white;height:100vh;}
#game{background:#4a7c2c;box-shadow:0 0 30px rgba(0,0,0,0.8);display:block;}
#ui{position:fixed;top:20px;left:20px;font-size:18px;font-weight:bold;color:#fff;text-shadow:2px 2px 4px #000;background:rgba(0,0,0,0.5);padding:10px;border-radius:8px;}
#gameOver{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;background:rgba(0,0,0,0.9);text-align:center;}
button{padding:12px 30px;border:none;border-radius:8px;font-size:18px;background:#22c55e;color:white;font-weight:bold;cursor:pointer;margin:5px;}
.back{position:fixed;top:20px;right:20px;padding:8px 16px;font-size:14px;}
</style>
</head>
<body>
<button class="back" onclick="location.href='index.html'">‚Üê Back</button>
<div id="ui">Level: 1 | Task: Drive to checkpoint<br>Speed: 0 km/h | Damage: 0%</div>
<div id="gameOver">
 <h1 id="endTitle">LEVEL COMPLETE!</h1>
 <div id="finalScore"></div>
 <button onclick="location.reload()">Restart</button>
 <button onclick="location.href='index.html'">Back to Menu</button>
</div>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=800;
canvas.height=600;
let difficulty=localStorage.getItem('gameDifficulty')||'easy';
let level=1;
let car={x:400,y:500,w:40,h:60,vx:0,vy:0,angle:0,speed:0,maxSpeed:5,damage:0};
let checkpoint={x:400,y:100,w:80,h:80};
let obstacles=[];
let trafficCars=[];
let parkingSpots=[];
let keys={};
let gameRunning=true;
let task='drive';
let speedLimit=difficulty==='hard'?40:difficulty==='medium'?50:60;
let score=0;
let timeBonus=100;

window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

function createObstacles(){
 obstacles=[];
 for(let i=0;i<3+level;i++){
  obstacles.push({
   x:Math.random()*700+50,
   y:Math.random()*400+100,
   w:35,
   h:35,
   type:'cone'
  });
 }
}

function createTraffic(){
 trafficCars=[];
 for(let i=0;i<1+Math.floor(level/2);i++){
  trafficCars.push({
   x:Math.random()*700+50,
   y:Math.random()*300+50,
   w:40,
   h:60,
   vx:(Math.random()-0.5)*1.5,
   vy:(Math.random()-0.5)*1.5,
   angle:Math.random()*Math.PI*2
  });
 }
}

function createParkingSpots(){
 parkingSpots=[];
 for(let i=0;i<3;i++){
  parkingSpots.push({
   x:100+i*250,
   y:50,
   w:70,
   h:90,
   occupied:i!==1
  });
 }
}

function update(){
 if(!gameRunning)return;
 
 let acceleration=0.15;
 let turnSpeed=0.05;
 
 if(keys['ArrowUp']||keys['w']||keys['W']){
  car.speed=Math.min(car.maxSpeed,car.speed+acceleration);
 }else if(keys['ArrowDown']||keys['s']||keys['S']){
  car.speed=Math.max(-car.maxSpeed/2,car.speed-acceleration);
 }else{
  car.speed*=0.95;
 }
 
 if(keys['ArrowLeft']||keys['a']||keys['A']){
  car.angle-=turnSpeed*Math.abs(car.speed);
 }
 if(keys['ArrowRight']||keys['d']||keys['D']){
  car.angle+=turnSpeed*Math.abs(car.speed);
 }
 
 car.vx=Math.sin(car.angle)*car.speed;
 car.vy=-Math.cos(car.angle)*car.speed;
 car.x+=car.vx;
 car.y+=car.vy;
 
 if(car.x<car.w/2||car.x>canvas.width-car.w/2){
  car.x=Math.max(car.w/2,Math.min(canvas.width-car.w/2,car.x));
  car.damage+=5;
 }
 if(car.y<car.h/2||car.y>canvas.height-car.h/2){
  car.y=Math.max(car.h/2,Math.min(canvas.height-car.h/2,car.y));
  car.damage+=5;
 }
 
 obstacles.forEach(o=>{
  if(Math.hypot(car.x-o.x,car.y-o.y)<car.w/2+o.w/2){
   car.damage+=2;
   o.x+=car.vx*2;
   o.y+=car.vy*2;
  }
 });
 
 trafficCars.forEach(t=>{
  t.x+=t.vx;
  t.y+=t.vy;
  if(t.x<30||t.x>canvas.width-30){t.vx*=-1;t.angle+=Math.PI;}
  if(t.y<30||t.y>canvas.height-30){t.vy*=-1;t.angle+=Math.PI;}
  
  if(Math.hypot(car.x-t.x,car.y-t.y)<car.w/2+t.w/2){
   car.damage+=8;
   car.speed*=-0.5;
  }
 });
 
 if(Math.abs(car.speed)*10>speedLimit){
  car.damage+=0.3;
 }
 
 timeBonus=Math.max(0,timeBonus-0.05);
 
 if(Math.hypot(car.x-checkpoint.x,car.y-checkpoint.y)<50&&Math.abs(car.speed)<0.5){
  score+=Math.floor(timeBonus);
  level++;
  timeBonus=100;
  if(level>5){
   gameRunning=false;
   document.getElementById("endTitle").innerText='DRIVING TEST PASSED!';
   document.getElementById("finalScore").innerText=`Score: ${score} | Damage: ${Math.floor(car.damage)}%`;
   document.getElementById("gameOver").style.display='flex';
  }else{
   checkpoint.x=Math.random()*600+100;
   checkpoint.y=Math.random()*400+100;
   createObstacles();
   createTraffic();
   createParkingSpots();
   car.maxSpeed+=0.3;
  }
 }
 
 if(car.damage>=100){
  gameRunning=false;
  document.getElementById("endTitle").innerText='TEST FAILED!';
  document.getElementById("finalScore").innerText='Too much damage! Drive carefully!';
  document.getElementById("gameOver").style.display='flex';
 }
}

function draw(){
 let roadGrad=ctx.createLinearGradient(0,0,0,canvas.height);
 roadGrad.addColorStop(0,'#4a5568');
 roadGrad.addColorStop(1,'#1f2937');
 ctx.fillStyle=roadGrad;
 ctx.fillRect(0,0,canvas.width,canvas.height);
 
 ctx.strokeStyle='#fbbf24';
 ctx.lineWidth=3;
 ctx.setLineDash([20,15]);
 for(let y=100;y<canvas.height;y+=100){
  ctx.beginPath();
  ctx.moveTo(0,y);
  ctx.lineTo(canvas.width,y);
  ctx.stroke();
 }
 for(let x=200;x<canvas.width;x+=200){
  ctx.beginPath();
  ctx.moveTo(x,0);
  ctx.lineTo(x,canvas.height);
  ctx.stroke();
 }
 ctx.setLineDash([]);
 
 parkingSpots.forEach(p=>{
  ctx.strokeStyle=p.occupied?'#ef4444':'#22c55e';
  ctx.lineWidth=3;
  ctx.strokeRect(p.x-p.w/2,p.y-p.h/2,p.w,p.h);
  ctx.fillStyle='rgba(255,255,255,0.1)';
  ctx.fillRect(p.x-p.w/2,p.y-p.h/2,p.w,p.h);
 });
 
 ctx.shadowColor='rgba(34,197,94,0.6)';
 ctx.shadowBlur=15;
 ctx.fillStyle='#22c55e';
 ctx.fillRect(checkpoint.x-checkpoint.w/2,checkpoint.y-checkpoint.h/2,checkpoint.w,checkpoint.h);
 ctx.shadowBlur=0;
 ctx.strokeStyle='#fff';
 ctx.lineWidth=4;
 ctx.strokeRect(checkpoint.x-checkpoint.w/2,checkpoint.y-checkpoint.h/2,checkpoint.w,checkpoint.h);
 ctx.fillStyle='#fff';
 ctx.font='32px Arial';
 ctx.textAlign='center';
 ctx.fillText('üèÅ',checkpoint.x,checkpoint.y+12);
 
 obstacles.forEach(o=>{
  ctx.shadowColor='rgba(0,0,0,0.3)';
  ctx.shadowBlur=5;
  ctx.fillStyle='#f97316';
  ctx.beginPath();
  ctx.moveTo(o.x,o.y-o.h/2);
  ctx.lineTo(o.x-o.w/2,o.y+o.h/2);
  ctx.lineTo(o.x+o.w/2,o.y+o.h/2);
  ctx.fill();
  ctx.shadowBlur=0;
  ctx.strokeStyle='#fff';
  ctx.lineWidth=2;
  ctx.stroke();
  ctx.fillStyle='#fff';
  ctx.beginPath();
  ctx.arc(o.x,o.y,o.w/6,0,Math.PI*2);
  ctx.fill();
 });
 
 trafficCars.forEach(t=>{
  ctx.save();
  ctx.translate(t.x,t.y);
  ctx.rotate(t.angle);
  ctx.shadowColor='rgba(0,0,0,0.4)';
  ctx.shadowBlur=6;
  let carGrad=ctx.createLinearGradient(-t.w/2,-t.h/2,t.w/2,t.h/2);
  carGrad.addColorStop(0,'#60a5fa');
  carGrad.addColorStop(1,'#3b82f6');
  ctx.fillStyle=carGrad;
  ctx.fillRect(-t.w/2,-t.h/2,t.w,t.h);
  ctx.shadowBlur=0;
  ctx.fillStyle='#1e40af';
  ctx.fillRect(-t.w/2+5,-t.h/2+5,t.w-10,t.h-10);
  ctx.fillStyle='#93c5fd';
  ctx.fillRect(-t.w/2+8,-t.h/2+8,t.w-16,15);
  ctx.fillStyle='#fbbf24';
  ctx.fillRect(-t.w/2+5,-t.h/2,t.w-10,4);
  ctx.restore();
 });
 
 ctx.save();
 ctx.translate(car.x,car.y);
 ctx.rotate(car.angle);
 ctx.shadowColor='rgba(0,0,0,0.4)';
 ctx.shadowBlur=8;
 let playerGrad=ctx.createLinearGradient(-car.w/2,-car.h/2,car.w/2,car.h/2);
 playerGrad.addColorStop(0,'#f87171');
 playerGrad.addColorStop(1,'#ef4444');
 ctx.fillStyle=playerGrad;
 ctx.fillRect(-car.w/2,-car.h/2,car.w,car.h);
 ctx.shadowBlur=0;
 ctx.fillStyle='#7f1d1d';
 ctx.fillRect(-car.w/2+5,-car.h/2+5,car.w-10,car.h-10);
 ctx.fillStyle='#60a5fa';
 ctx.fillRect(-car.w/2+8,-car.h/2+8,car.w-16,15);
 ctx.fillStyle='#fbbf24';
 ctx.fillRect(-car.w/2+5,-car.h/2,car.w-10,5);
 ctx.fillStyle='#fff';
 ctx.fillRect(-car.w/2+8,-car.h/2+25,car.w-16,8);
 ctx.restore();
 
 let speedKmh=Math.abs(car.speed)*10;
 let speedColor=speedKmh>speedLimit?'#ef4444':'#22c55e';
 document.getElementById("ui").innerHTML=`Level: ${level}/5 | Score: ${score+Math.floor(timeBonus)}<br>Speed: <span style="color:${speedColor}">${Math.floor(speedKmh)} km/h</span> (Limit: ${speedLimit}) | Damage: ${Math.floor(car.damage)}% | Time Bonus: ${Math.floor(timeBonus)}`;
}

function gameLoop(){
 update();
 draw();
 requestAnimationFrame(gameLoop);
}

createObstacles();
createTraffic();
createParking Spots();
gameLoop();
</script>
</body>
</html>
